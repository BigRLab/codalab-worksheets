(function(a,e,c){var b=a(document);c=e.Modernizr;a(document).ready(function(){a.fn.foundationAlerts&&b.foundationAlerts();a.fn.foundationButtons&&b.foundationButtons();a.fn.foundationAccordion&&b.foundationAccordion();a.fn.foundationNavigation&&b.foundationNavigation();a.fn.foundationTopBar&&b.foundationTopBar();a.fn.foundationCustomForms&&b.foundationCustomForms();a.fn.foundationMediaQueryViewer&&b.foundationMediaQueryViewer();a.fn.foundationTabs&&b.foundationTabs({callback:a.foundation.customForms.appendCustomMarkup});
a.fn.foundationTooltips&&b.foundationTooltips();a.fn.foundationMagellan&&b.foundationMagellan();a.fn.foundationClearing&&b.foundationClearing();a.fn.placeholder&&a("input, textarea").placeholder()});c.touch&&!e.location.hash&&a(e).load(function(){setTimeout(function(){e.scrollTo(0,1)},0)})})(jQuery,this);var BundleContentNode=function(){function a(a,c,b,d){this.url=a;this.name=c;this.parent=b;this.children=d}a.prototype.isRootNode=function(){return void 0===this.parent};a.prototype.isLeafNode=function(){return null===this.children};a.prototype.getUrl=function(){return this.url};a.prototype.getName=function(){return this.name};a.prototype.getFullName=function(){return this.isRootNode()?this.name:[this.parent.getFullName(),this.name].join("/")};a.prototype.getParent=function(){return this.parent};a.prototype.getChildren=
function(){return this.children};a.prototype.setChildren=function(a){this.children=a};a.prototype.getData=function(){return this.data};a.prototype.setData=function(a){this.data=a};return a}(),BundleRenderer=function(){function a(a){this.template=a}a.loadContentAsync=function(e,c){$.ajax({type:"GET",url:[c.getUrl(),c.getFullName()].join("/"),cache:!1,success:function(b){var d=[];Array.isArray(b)&&2==b.length&&(d=b[0].map(function(b){return new BundleContentNode(c.getUrl(),b,c)}),b=b[1].map(function(b){return new BundleContentNode(c.getUrl(),
b,c,null)}),d=d.concat(b).sort(function(b,d){return b.getName().localeCompare(d.getName())}));c.setChildren(d);a.renderTable(e,a.getContentTableModel(c,e))},error:function(b,d,a){}})};a.loadFileContentAsync=function(e,c){$.ajax({type:"GET",url:[c.getUrl().replace("api/bundles/content","api/bundles/filecontent"),c.getFullName()].join("/"),cache:!1,success:function(b){c.setData(b);a.renderTable(e,a.getContentTableModel(c,e))},error:function(b,d,a){}})};a.getContentTableModel=function(e,c){var b=0;!1==
e.isRootNode()&&(b+=1);if(e.isLeafNode())b+=1;else{var d=e.getChildren();void 0!==d&&(b+=d.length)}var f=function(b){b.setAttribute("class","col bundle__file_view__icon");var d=document.createElement("i");d.setAttribute("class","fi-arrow-left");b.appendChild(d);d.onclick=function(b){a.loadContentAsync(c,e.getParent());b.preventDefault()}},h=function(b){b.setAttribute("class","col bundle-item-type-goup");for(var d=[],f=e.getParent();void 0!==f;)d.push(f),f=f.getParent();d.reverse().forEach(function(d){var f=
document.createElement("a");f.textContent=d.getName();f.setAttribute("href","");f.onclick=function(b){a.loadContentAsync(c,d);b.preventDefault()};b.appendChild(f);b.appendChild(document.createTextNode(" / "))});b.appendChild(document.createTextNode(e.getName()))},g=function(b,d){b.setAttribute("class","col bundle__file_view__icon");var a=document.createElement("i");void 0!==d&&a.setAttribute("class",d.isLeafNode()?"fi-page":"fi-folder");b.appendChild(a)},k=function(b,d){if(d.isLeafNode()){b.setAttribute("class",
"col");var f=document.createElement("a");f.textContent=d.getName();f.setAttribute("href","");f.onclick=function(b){a.loadFileContentAsync(c,d);b.preventDefault()}}else b.setAttribute("class","col bundle-item-type-folder"),f=document.createElement("a"),f.textContent=d.getName(),f.setAttribute("href",""),f.onclick=function(b){a.loadContentAsync(c,d);b.preventDefault()};b.appendChild(f)},d=function(b,d){var a=document.createElement("img"),c=[d.getUrl().replace("api/bundles/content","api/bundles/filecontent"),
d.getFullName()].join("/");a.setAttribute("src",c);a.setAttribute("style","max-width:900px");return[a]},l=function(b,d){var a=document.createElement("iframe"),c=[d.getUrl().replace("api/bundles/content","api/bundles/filecontent"),d.getFullName()].join("/");a.setAttribute("src",c);a.setAttribute("style","width:100%; min-height:"+Math.max(200,Math.min(900,screen.height/2))+"px;");return[a]},m={txt:function(b,d){var a=document.createElement("pre");a.setAttribute("class","bundle__file_pre");a.textContent=
d.getData();return[a]},htm:l,html:l,jpg:d,png:d},n=function(b,d){var a=d.getName(),c="";0<a.indexOf(".")&&(c=a.toLowerCase().split(".").pop());a=m[c];void 0===a&&(a=m.txt);b.setAttribute("class","col");a(b,d).forEach(function(d){b.appendChild(d)})};return{tableDecorations:"bundle__file_view expanded",rowDecorations:"row",numRows:b,numCols:2,render:function(b,d,a){if(!1===e.isRootNode()&&0>=b)0==d?f(a):h(a);else if(!0===e.isLeafNode())0==d?g(a):n(a,e);else{var c=0;!1===e.isRootNode()&&(c=1);b=e.getChildren()[b-
c];0==d?g(a,b):k(a,b)}}}};a.getMetadataTableModel=function(a){var c=[],b;for(b in a.metadata)"name"!==b&&c.push([b,a.metadata[b]]);return{tableDecorations:"bundle__meta_table",rowDecorations:"row",numRows:c.length,numCols:2,render:function(b,a,h){0==a?h.setAttribute("class","col bundle__meta_type"):h.setAttribute("class","col");h.textContent=c[b][a]}}};a.getElementType=function(a,c){return void 0!==a?a:c};a.renderTable=function(e,c){var b=a.getElementType(c.tableElementType,"table"),d=a.getElementType(c.rowElementType,
"tr"),f=a.getElementType(c.columnElementType,"td"),b=document.createElement(b);void 0!==c.tableDecorations&&b.setAttribute("class",c.tableDecorations);for(var h=0;h<c.numRows;h++){var g=document.createElement(d);if(0<c.numCols)for(var k=0;k<c.numCols;k++){var l=document.createElement(f);c.render(h,k,l);g.appendChild(l)}else c.render(h,g);b.appendChild(g)}void 0!=e.firstChild&&e.removeChild(e.firstChild);e.appendChild(b)};a.prototype.render=function(e){var c=$(this.template.cloneNode(!0));c.find(".bundle-name").text(e.metadata.name);
c.find(".bundle-icon-sm").removeClass("bundle-icon-sm").addClass("bundle-icon-sm--"+e.bundle_type+"--"+e.state);c.find(".bundle-uuid").text(e.uuid);c.find(".bundle-link").attr("href","/bundles/"+e.uuid);c.find(".bundle-download").on("click",function(b){alert("This will allow you to download the bundle");b.preventDefault()});var b=c.find(".bundle-meta-view-container").get(0);a.renderTable(b,a.getMetadataTableModel(e));var b=c.find(".bundle__expand_button"),d=c.find(".bundle-file-view-container");b.on("click",
function(b){var c=$(b.target);if(c.hasClass("expanded"))d.removeClass("expanded"),d.children().removeClass("expanded"),c.removeClass("expanded"),c.html('SHOW BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="More">');else{if(void 0==d.get(0).firstChild){var g=new BundleContentNode("/api/bundles/content",e.uuid);a.loadContentAsync(d.get(0),g)}else d.children().addClass("expanded");d.addClass("expanded");c.addClass("expanded");c.html('HIDE BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="Less">')}b.preventDefault()});
return c.get(0)};return a}(),WorksheetRenderer=function(){return function(a,e,c){this.renderer=e;if(c&&c.items&&Array.isArray(c.items)){var b=this;e=c.name;if(0<c.items.length){var d=c.items[0];null===d[0]&&0==d[1].indexOf("#")&&(e=markdown.toHTML(d[1]).replace(/^<h1>/,"").replace(/<\/h1>$/,""),c.items=c.items.slice(1))}$(".worksheet-icon").html(e);$(".worksheet-author").html("by codalab");c.items.forEach(function(d){if(null===d[0]){var c=document.createElement("div");c.innerHTML=markdown.toHTML(d[1]);
a.appendChild(c)}else a.appendChild(b.renderer.render(d[0]))});MathJax.Hub.Queue(["Typeset",MathJax.Hub,a.id]);MathJax.Hub.Queue(function(){for(var b=MathJax.Hub.getAllJax(),d=0;d<b.length;d+=1)$(b[d].SourceElement().parentNode).addClass("coda-jax")})}}}();var Competition;
(function(a){function e(b,d){d?(b.removeClass("leaderBoardSubmit"),b.addClass("leaderBoardRemove"),b.text("Remove from Leaderboard")):(b.removeClass("leaderBoardRemove"),b.addClass("leaderBoardSubmit"),b.text("Submit to Leaderboard"))}function c(b,d,a,c){b="/api/competition/"+b+"/submission/"+d+"/leaderboard";var g="delete";c.hasClass("leaderBoardSubmit")&&(g="post");request=$.ajax({url:b,type:g,datatype:"text",data:{csrfmiddlewaretoken:a},success:function(b,a,f){(b="post"==g)?(a=$("#user_results td.status"),
a.removeClass("submitted"),a.addClass("not_submitted"),a.html(""),a=$("#"+d+" td.status"),a.addClass("submitted"),a.html("<i class='fi-check'></i>"),$("#user_results button.leaderBoardRemove").each(function(b){e($(this),!1)})):(a=$("#"+d+" td.status"),a.removeClass("submitted"),a.addClass("not_submitted"),a.html(""));e(c,b)},error:function(b,a,d){alert("An error occurred. Please try again or report the issue")},beforeSend:function(b){b.setRequestHeader("X-CSRFToken",a)}})}a.invokePhaseButtonOnOpen=
function(b){var a=$("#"+b+" .button.selected")[0];void 0===a&&(a=$("#"+b+" .button.active")[0],void 0===a&&(a=$("#"+b+" .button")[0]));a.click()};a.getPhaseSubmissions=function(b,d,c){$(".competition_submissions").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+b+"/submissions/"+d,cache:!1,success:function(d){$(".competition_submissions").html("").append(d);!1===CodaLab.FileUploader.isSupported()?($("#fileUploadButton").addClass("disabled"),
$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new CodaLab.FileUploader({buttonId:"fileUploadButton",sasEndpoint:"/api/competition/"+b+"/submission/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(b,a){$("#fileUploadButton").addClass("disabled")},afterSelection:function(b,a){!1===a&&(0<b.files.length&&("type-error"===b.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):
$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#fileUploadButton").removeClass("disabled"))},uploadProgress:function(b,a,d){a=100*a/d;$("#details").html("Uploading file <em>"+b.name+"</em>: "+a.toFixed(0)+"% complete.")},uploadError:function(b){$("#details").html("There was an error uploading the file. Please try again.");$("#fileUploadButton").removeClass("disabled")},uploadSuccess:function(d,c){$("#details").html("Creating new submission...");$.ajax({url:"/api/competition/"+
b+"/submission",type:"post",cache:!1,data:{id:c,name:d.name,type:d.type,size:d.size}}).done(function(b){$("#details").html("");$("#user_results tr.noData").remove();$("#user_results").append(a.displayNewSubmission(b));$("#user_results #"+b.id+" .fi-plus").on("click",function(){a.showOrHideSubmissionDetails(this)});$("#fileUploadButton").removeClass("disabled");$("#user_results #"+b.id+" .fi-plus").click()}).fail(function(b){var a="An unexpected error occured.";403==b.status&&(a=b.responseJSON.detail);
$("#details").html(a);$("#fileUploadButton").removeClass("disabled")})}});$("#user_results .fi-plus").on("click",function(){a.showOrHideSubmissionDetails(this)})},error:function(b,a,d){$(".competition_submissions").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};a.getPhaseResults=function(b,a){$(".competition_results").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+
b+"/results/"+a,cache:!1,success:function(b){$(".competition_results").html("").append(b);$(".column-selectable").click(function(b){b=$(this).closest("table");$(b).find(".column-selected").removeClass();$(this).addClass("column-selected");var a=$(this).attr("name");b=b.find("td").filter(function(){return $(this).attr("name")===a}).addClass("column-selected");if(0<b.length)for(var d=b.slice().sort(function(b,a){var d=parseInt($.text([$(b).find("span")]));isNaN(d)&&(d=1E5);var c=parseInt($.text([$(a).find("span")]));
isNaN(c)&&(c=1E5);return d-c}),c=b[0].parentNode.parentNode,d=d.map(function(){return this.parentNode.cloneNode(!0)}),f=0;f<d.length;f++)$(d[f]).find("td.row-position").text($(d[f]).find("td.column-selected span").text()),c.insertBefore(d[f],b[f].parentNode),c.removeChild(b[f].parentNode)})},error:function(b,a,d){$(".competition_results").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};a.registationCanProceed=function(){!0===$("#checkbox").is(":checked")?
$("#participateButton").removeClass("disabledStatus"):$("#participateButton").addClass("disabledStatus")};a.displayRegistrationStatus=function(b){var a="";$.ajax({type:"GET",url:"/api/competition/"+b+"/mystatus/",cache:!1,success:function(b){console.log(b);"approved"==b.status?location.reload():"pending"==b.status?(a="<div class='participateInfoBlock pendingApproval'>",a+="<div class='infoStatusBar'></div>",a+="<div class='labelArea'>",a+="<label class='regApprovLabel'>Your request to participate in this challenge has been received and a decision is pending.</label>",
a+="<label></label>",a+="</div>",a+="</div>"):"denied"==b.status&&(a="<div class='participateInfoBlock'>",a+="<div class='infoStatusBar'></div>",a+="<div class='labelArea'>",a+="<label class='regDeniedLabel'>Your request to participate in this challenge has been denied. The reason for your denied registrations is: "+b.reason+"</label>",a+="<label></label>",a+="</div>",a+="</div>");location.reload()},error:function(b,a,d){$(".competition_results").html("<div class='alert - error'>An error occurred. Please try refreshing the page.</div>")}});
return a};a.displayNewSubmission=function(b){var d=$("#submission_details_template #submission_row_template tr").clone();$(d).attr("id",b.id.toString());$(d).addClass(a.oddOrEven(b.submission_number));$(d).children().each(function(d){switch(d){case 0:"finished"===b.status&&$(this).val("1");break;case 1:$(this).html(b.submission_number.toString());break;case 2:$(this).html(b.filename);break;case 3:var c=function(b){b=b.toString();1==b.length&&(b="0"+b);return b},e=new Date(b.submitted_at);d=$.datepicker.formatDate("mm/dd/yy",
e).toString();var k=e.getHours().toString(),l=c(e.getMinutes()),c=c(e.getSeconds());$(this).html(d+" "+k+":"+l+":"+c);break;case 4:$(this).html(a.getSubmissionStatus(b.status))}});return d};a.oddOrEven=function(b){return b&1?"odd":"even"};a.getSubmissionStatus=function(b){var a="Unknown";"submitting"===b?a="Submitting":"submitted"===b?a="Submitted":"running"===b?a="Running":"failed"===b?a="Failed":"cancelled"===b?a="Cancelled":"finished"===b&&(a="Finished");return a};a.showOrHideSubmissionDetails=
function(b){var d=$(b).parents("tr")[0];if($(b).hasClass("fi-minus"))$(b).removeClass("fi-minus"),$(b).addClass("fi-plus"),$(d).next("tr.trDetails").remove();else{$(b).removeClass("fi-plus");$(b).addClass("fi-minus");b=$("#submission_details_template .trDetails").clone();b.find(".tdDetails").attr("colspan",d.cells.length);b.find("a").each(function(b){$(this).attr("href",$(this).attr("href").replace("_",d.id))});var f=$("#phasestate").val(),h=$(d).find("input[name='state']").val();if(1==f&&1==h){var g=
b.find("button");g.removeClass("hide");var f=$(d).find(".status").hasClass("submitted"),k=$("#competitionId").val();e(g,f);g.on("click",function(){c(k,d.id,$("#cstoken").val(),g)})}else{f=$.trim($(d).find(".statusName").html());g=b.find("button").addClass("hide");if("Submitting"===f||"Submitted"===f||"Running"===f)g.removeClass("hide"),g.text("Refresh status"),g.on("click",function(){a.updateSubmissionStatus($("#competitionId").val(),d.id,this)});"Failed"!==f&&"Cancelled"!==f||b.find("a").removeClass("hide")}$(d).after(b)}};
a.updateSubmissionStatus=function(b,d,f){$(f).parents(".submission_details").find(".preloader-handler").append("<div class='competitionPreloader'></div>").children().css({top:"25px",display:"block"});$.ajax({type:"GET",url:"/api/competition/"+b+"/submission/"+d,cache:!1,success:function(e){$("#user_results #"+d).find(".statusName").html(a.getSubmissionStatus(e.status));if("finished"===e.status)$("#user_results #"+d+"input:hidden").val("1"),1==$("#phasestate").val()?($(f).addClass("leaderBoardSubmit"),
$(f).text("Submit to Leaderboard"),$(f).on("click",function(){c(b,d,$("#cstoken").val(),$(f))})):$(f).addClass("hide");else if("failed"===e.status||"cancelled"===e.status)$(f).addClass("hide"),$(f).parent().parent().find("a").removeClass("hide");$(".competitionPreloader").hide()},error:function(b,a,d){}})};a.initialize=function(){$(document).ready(function(){$("#participate_form").submit(function(b){b.preventDefault();if($("#participateButton").hasClass("disabledStatus"))return!1;$("#result").html("");
b=$(this).serialize();var c=$("#competitionId").val();request=$.ajax({url:"/api/competition/"+c+"/participate/",type:"post",dataType:"text",data:b,success:function(b,d,e){$(".content form").replaceWith(a.displayRegistrationStatus(c))},error:function(b,a,d){alert("There was a problem registering for this competition.")}});return!1});$("#submissions_phase_buttons .button").each(function(b,c){$(this).click(function(){var b=$.trim($(this).attr("id").replace("submissions_phase_",""));$("#submissions_phase_buttons .button").removeClass("selected");
$(this).addClass("selected");var d=$("#competitionId").val(),c=$("#cstoken").val();a.getPhaseSubmissions(d,b,c)})});$("a[href='#participate-submit_results']").click(function(b){a.invokePhaseButtonOnOpen("submissions_phase_buttons")});$("#results_phase_buttons .button").each(function(b,c){$(this).click(function(){var b=$.trim($(this).attr("id").replace("results_phase_",""));$("#results_phase_buttons .button").removeClass("selected");$(this).addClass("selected");var d=$("#competitionId").val();a.getPhaseResults(d,
b)})});$("#Results").click(function(b){a.invokePhaseButtonOnOpen("results_phase_buttons")});$(this).foundation("section","reflow");$(".top-bar-section ul > li").removeClass("active");$("#liCompetitions").addClass("active");$(".my_managing .competition-tile #competition-actions").each(function(b,a){$(this).children("#competition-publish-button").click(function(){var b=$(this).parent()[0];request=$.ajax({url:$(this)[0].value,success:function(a,d,c){console.log("Published competition.");$(b).children("#competition-publish-button").hide();
$(b).children("#competition-delete-button").hide();$(b).children("#competition-unpublish-button").show()},error:function(b,a,d){console.log("Error publishing competition!")}})});$(this).children("#competition-unpublish-button").click(function(){});"True"==$(this)[0].getAttribute("published")?($(this).children("#competition-delete-button").hide(),$(this).children("#competition-publish-button").hide(),$(this).children("#competition-unpublish-button").show()):($(this).children("#competition-delete-button").show(),
$(this).children("#competition-publish-button").show(),$(this).children("#competition-unpublish-button").hide())});var b=window.location.href;void 0!==b&&(null!==b.match(/#participate-submit_results$/i)?a.invokePhaseButtonOnOpen("submissions_phase_buttons"):null!==b.match(/#results$/i)&&a.invokePhaseButtonOnOpen("results_phase_buttons"))})}})(Competition||(Competition={}));var csrftoken;function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}function sameOrigin(a){var e="//"+document.location.host,c=document.location.protocol+e;return a==c||a.slice(0,c.length+1)==c+"/"||a==e||a.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(a)}$(function(){csrftoken=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(a,e){!csrfSafeMethod(e.type)&&sameOrigin(e.url)&&a.setRequestHeader("X-CSRFToken",csrftoken)}})});var CodaLab;
(function(a){var e=function(){function a(b){var d=this;this.defaultOptions={buttonId:"fileUploadButton",disabledClassName:"disabled",beforeSelection:function(){},afterSelection:function(b,a){},uploadProgress:function(b,a,d){},uploadSuccess:function(b){},uploadError:function(b){},allowedFileTypes:void 0,maxFileSizeInBytes:void 0,maxBlockSizeInBytes:1048576};this.options=$.extend({},this.defaultOptions,b);var c=$("#"+this.options.buttonId);this.setupFileInput();c.after(this.fileInput);c.on("click",
function(b){c.hasClass(d.options.disabledClassName)||d.fileInput.click()})}a.prototype.setupFileInput=function(){var b=this,d=this.fileInput;this.fileInput=$(document.createElement("input"));this.fileInput.attr("type","file");this.fileInput.attr("style","visibility: hidden; width: 1px; height: 1px;");this.fileInput.on("change",function(d){b.options.beforeSelection();d=b.validate();var e=0<d.files.length&&!0===a.selectionIsValid(d);b.options.afterSelection(d,e);e?b.beginUpload(d,0):b.setupFileInput()});
void 0!==d&&d.replaceWith(this.fileInput)};a.prototype.validate=function(){var b=this,a=this.fileInput.get(0).files,c=[];0<a.length&&$.each(a,function(a,d){var e=[];b.options.maxFileSizeInBytes&&d.size>b.options.maxFileSizeInBytes&&e.push({kind:"size-error"});b.options.allowedFileTypes&&-1===$.inArray(d.type,b.options.allowedFileTypes)&&e.push({kind:"type-error"});c.push({file:d,errors:e})});return{files:c}};a.selectionIsValid=function(b){return 0===b.files.map(function(b){return b.errors.length}).reduce(function(b,
a,c,e){return b+a},0)};a.prototype.getCurrentFile=function(){if(void 0!==this.state)return this.state.selection.files[this.state.fileIndex].file};a.prototype.getFileReader=function(){var b=this,a=new FileReader;a.onload=function(a){var d=b.state.sasUrl+"&comp=block&blockid="+b.state.blockIds[b.state.blockIds.length-1];a=new Uint8Array(a.target.result);var c=b.state.sasVersion;$.ajax({url:d,type:"PUT",data:a,processData:!1,beforeSend:function(b){b.setRequestHeader("x-ms-version",c);b.setRequestHeader("x-ms-blob-type",
"BlockBlob")},success:function(a,d){var c=b.getCurrentFile();b.options.uploadProgress(c,b.state.bytesUploaded,c.size);b.state.bytesUploaded<c.size?b.upload():b.endUpload()},error:function(a,d,c){b.options.uploadError({kind:"write-error",jqXHR:a,file:b.getCurrentFile()})}})};a.onerror=function(a){b.options.uploadError({kind:"read-error",message:a.message,file:b.getCurrentFile()})};return a};a.prototype.beginUpload=function(b,a){this.state={sasUrl:void 0,sasVersion:void 0,trackingId:void 0,reader:void 0,
selection:b,fileIndex:a,blockIds:[],bytesUploaded:0};var c=this.getCurrentFile(),e=this;$.ajax({url:e.options.sasEndpoint,type:"POST",data:{name:c.name,type:c.type,size:c.size},success:function(b,a){e.state.sasUrl=b.url;e.state.sasVersion=b.version;e.state.trackingId=b.id;e.state.reader=e.getFileReader();e.options.uploadProgress(c,e.state.bytesUploaded,c.size);e.upload()},error:function(b,a,d){e.options.uploadError({kind:"sas-error",jqXHR:b,file:e.getCurrentFile()})}})};a.prototype.upload=function(){var b=
this.getCurrentFile(),a=this.state.bytesUploaded,c=a+Math.min(b.size-a,this.options.maxBlockSizeInBytes),b=b.slice(a,c),a="000000"+(this.state.blockIds.length+1),a=btoa(a.substring(a.length-6));this.state.blockIds.push(a);this.state.bytesUploaded=c;this.state.reader.readAsArrayBuffer(b)};a.prototype.endUpload=function(){var a=this.state.sasUrl+"&comp=blocklist",d=this.getCurrentFile(),c=['<?xml version="1.0" encoding="utf-8"?>'];c.push("<BlockList>");for(var e=0;e<this.state.blockIds.length;e++)c.push("  <Latest>"+
this.state.blockIds[e]+"</Latest>");c.push("</BlockList>");var g=this;$.ajax({url:a,type:"PUT",contentType:"application/xml",processData:!1,data:c.join("\n"),beforeSend:function(a){a.setRequestHeader("x-ms-version",g.state.sasVersion);a.setRequestHeader("x-ms-blob-content-type",d.type);a.setRequestHeader("x-ms-meta-name",d.name);a.setRequestHeader("x-ms-meta-size",d.size.toString())},success:function(a,b){g.options.uploadSuccess(d,g.state.trackingId);var c=1+g.state.fileIndex;c<g.state.selection.files.length?
g.beginUpload(g.state.selection,c):g.setupFileInput()},error:function(a,b,c){g.options.uploadError({kind:"write-error",jqXHR:a,file:g.getCurrentFile()})}})};a.isSupported=function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1};return a}();a.FileUploader=e;(function(a){a.CreateReady=function(){!1===e.isSupported()?($("#uploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new e({buttonId:"uploadButton",
sasEndpoint:"/api/competition/create/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,c){$("#uploadButton").addClass("disabled")},afterSelection:function(a,c){!1===c&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#uploadButton").removeClass("disabled"))},
uploadProgress:function(a,c,e){c=100*c/e;$("#details").html("Uploading file <em>"+a.name+"</em>: "+c.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#uploadButton").removeClass("disabled")},uploadSuccess:function(a,c){$("#details").html("Creating competition... This may take a while. Please be patient.");$.ajax({url:"/api/competition/create",type:"post",cache:!1,data:{id:c,name:a.name,type:a.type,size:a.size}}).done(function(a){var b=
function(){$.ajax({url:"/api/competition/create/"+a.token,type:"get",cache:!1,data:{csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val()}}).done(function(a){"finished"==a.status?($("#details").html("Congratulations! Your new competition is ready to <a href='/competitions/"+a.id+"'>view</a>. You can also manage it from <a href='/my/#manage'>your CodaLab dashboard.</a>"),$("#uploadButton").removeClass("disabled")):"failed"==a.status?($("#details").html("Oops! There was a problem creating the competition."),
$("#uploadButton").removeClass("disabled")):setTimeout(b,1E3)}).fail(function(){$("#details").html("An unexpected error occured.");$("#uploadButton").removeClass("disabled")})};b()}).fail(function(){$("#details").html("An unexpected error occured.");$("#uploadButton").removeClass("disabled")})}})}})(a.Competitions||(a.Competitions={}))})(CodaLab||(CodaLab={}));angular.module("codalab.services",[]);angular.module("codalab.controllers",[]);angular.module("codalab.directives",[]);
angular.module("codalab",["ngRoute","ngAnimate","codalab.controllers","codalab.services","codalab.directives"]).factory("$exceptionHandler",function(){return function(a){console.error(a.message);error(a)}}).config(["$routeProvider","$locationProvider","$httpProvider","$interpolateProvider",function(a,e,c,b){a.when("/worksheets/app/:uuid/",{templateUrl:"/static/app/partials/worksheet.html",controller:"worksheet"}).otherwise({templateUrl:"/static/app/partials/worksheets.html",controller:"worksheets"});
e.html5Mode(!0);b.startSymbol("{[{");b.endSymbol("}]}")}]);angular.module("codalab.services").factory("worksheetsApi",["$http",function(a){var e=function(a,b,c,e){return a.data},c=function(a,b,c,e){throw a;},b=function(b){return function(){return a.get(b).then(e,c)}};return{info:b("/api/worksheets/info/"),worksheets:b("/api/worksheets/"),createWorksheet:function(b){return function(f){var h=$.cookie("csrftoken");!csrfSafeMethod("POST")&&sameOrigin(b)&&(a.defaults.headers.common["X-CSRFToken"]=h);return a.post(b,f).then(e,c)}}("/api/worksheets/")}}]);angular.module("codalab.controllers").controller("root",["$scope","worksheetsApi",function(a,e){e.info().then(function(c){a.config=c.config;a.user=c.user})}]);angular.module("codalab.controllers").controller("worksheets",["$scope","worksheetsApi",function(a,e){a.status="loading";a.selectionIndex=0;a.worksheets=[];a.statusMessage=function(c){var b={"":"",loading:"Loading worksheets...",loaderror:"Couldn't retrive worksheets - Try refreshing the page",empty:"There are no worksheets.",saving:"Saving",saveerror:"Couldn't save - Try a different name"};switch(c){case "loaded":return 0<a.worksheets.length?"":b.empty}return b[c]};a.hasStatus=function(a){return a&&
0<a.length};e.worksheets().then(function(c){a.status="loaded";angular.forEach(c,function(b){b.url="/worksheets/"+b.uuid;b.target="_self";b.editable=!1;a.worksheets.push(b)})},function(){a.status="loaderror"});a.saveWorksheet=function(a){a.status="saving";e.createWorksheet(a).then(function(b){a.uuid=b.uuid;a.url="/worksheets/"+a.uuid;a.editable=!1;a.target="_self"},function(){a.status="saveerror"})};a.worksheetEnabled=function(a){return 0<a.name.length};a.addWorksheet=function(c,b){a.selectionIndex=
c+(b?1:0);a.worksheets.splice(a.selectionIndex,0,{name:"",editable:!0,url:"#"})};a.keyPressed=function(c){if(c.ctrlKey)switch(c.keyCode){case 38:case 40:a.addWorksheet(a.selectionIndex,40===c.keyCode),c.preventDefault()}else switch(c.keyCode){case 38:a.selectionIndex=0<a.selectionIndex?a.selectionIndex-1:0;c.preventDefault();break;case 40:a.selectionIndex=a.selectionIndex<a.worksheets.length-1?a.selectionIndex+1:a.worksheets.length-1,c.preventDefault()}};a.gotFocus=function(c){a.selectionIndex=c};
a.lostFocus=function(c){a.selectionIndex===c&&(a.selectionIndex=a.selectionIndex===a.worksheets.length-1?a.selectionIndex=a.worksheets.length:-1)}}]);angular.module("codalab.controllers").controller("worksheet",["$scope","worksheetsApi",function(a,e){a.status="Loading worksheet..."}]);angular.module("codalab.directives").directive("shortcut",function(){return{restrict:"E",replace:!0,scope:!0,link:function(a,e,c){var b=function(b){a.$apply(a.keyPressed(b))};$(document).on("keydown",b);a.$on("$destroy",function(){$(document).off("keydown",b)})}}});angular.module("codalab.directives").directive("setFocus",["$timeout",function(a){return{scope:{trigger:"@setFocus"},restrict:"A",link:function(e,c,b){b.$observe("setFocus",function(b){"true"===b&&document.activeElement!=c&&a(function(){"true"===e.trigger&&(c[0].focus(),e.trigger=!1)})})}}}]);angular.module("codalab.directives").directive("scrollIntoView",["$timeout",function(a){return{scope:{trigger:"@scrollIntoView"},restrict:"A",link:function(e,c,b){b.$observe("scrollIntoView",function(b,f){"true"===b&&b!==f&&a(function(){"true"===e.trigger&&(c[0].scrollIntoView(),e.trigger=!1)})})}}}]);//# sourceMappingURL=/static/codalab.min.map
