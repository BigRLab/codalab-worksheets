(function(a,e,d){var b=a(document);d=e.Modernizr;a(document).ready(function(){a.fn.foundationAlerts&&b.foundationAlerts();a.fn.foundationButtons&&b.foundationButtons();a.fn.foundationAccordion&&b.foundationAccordion();a.fn.foundationNavigation&&b.foundationNavigation();a.fn.foundationTopBar&&b.foundationTopBar();a.fn.foundationCustomForms&&b.foundationCustomForms();a.fn.foundationMediaQueryViewer&&b.foundationMediaQueryViewer();a.fn.foundationTabs&&b.foundationTabs({callback:a.foundation.customForms.appendCustomMarkup});
a.fn.foundationTooltips&&b.foundationTooltips();a.fn.foundationMagellan&&b.foundationMagellan();a.fn.foundationClearing&&b.foundationClearing();a.fn.placeholder&&a("input, textarea").placeholder()});d.touch&&!e.location.hash&&a(e).load(function(){setTimeout(function(){e.scrollTo(0,1)},0)})})(jQuery,this);var BundleContentNode=function(){function a(a,d,b,c){this.url=a;this.name=d;this.parent=b;this.children=c}a.prototype.isRootNode=function(){return void 0===this.parent};a.prototype.isLeafNode=function(){return null===this.children};a.prototype.getUrl=function(){return this.url};a.prototype.getName=function(){return this.name};a.prototype.getFullName=function(){return this.isRootNode()?this.name:[this.parent.getFullName(),this.name].join("/")};a.prototype.getParent=function(){return this.parent};a.prototype.getChildren=
function(){return this.children};a.prototype.setChildren=function(a){this.children=a};a.prototype.getData=function(){return this.data};a.prototype.setData=function(a){this.data=a};return a}(),BundleRenderer=function(){function a(a){this.template=a}a.loadContentAsync=function(e,d){console.log("loadContentAsync");$.ajax({type:"GET",url:[d.getUrl(),d.getFullName()].join("/"),cache:!1,success:function(b){console.log(b);console.log("");var c=[];Array.isArray(b)&&2==b.length&&(c=b[0].map(function(b){return new BundleContentNode(d.getUrl(),
b,d)}),b=b[1].map(function(b){return new BundleContentNode(d.getUrl(),b,d,null)}),c=c.concat(b).sort(function(b,c){return b.getName().localeCompare(c.getName())}));d.setChildren(c);a.renderTable(e,a.getContentTableModel(d,e))},error:function(b,c,a){}})};a.loadFileContentAsync=function(e,d){console.log("loadFileContentAsync");$.ajax({type:"GET",url:[d.getUrl().replace("api/bundles/content","api/bundles/filecontent"),d.getFullName()].join("/"),cache:!1,success:function(b){console.log(b);console.log("");
d.setData(b);a.renderTable(e,a.getContentTableModel(d,e))},error:function(b,c,a){}})};a.getContentTableModel=function(e,d){var b=0;!1===e.isRootNode()&&(b+=1);if(e.isLeafNode())b+=1;else{var c=e.getChildren();void 0!==c&&(b+=c.length)}var f=function(b){b.setAttribute("class","col bundle__file_view__icon");var c=document.createElement("i");c.setAttribute("class","fi-arrow-left");b.appendChild(c);c.onclick=function(b){a.loadContentAsync(d,e.getParent());b.preventDefault()}},h=function(b){b.setAttribute("class",
"col bundle-item-type-goup");for(var c=[],f=e.getParent();void 0!==f;)c.push(f),f=f.getParent();c.reverse().forEach(function(c){var f=document.createElement("a");f.textContent=c.getName();f.setAttribute("href","");f.onclick=function(b){a.loadContentAsync(d,c);b.preventDefault()};b.appendChild(f);b.appendChild(document.createTextNode(" / "))});b.appendChild(document.createTextNode(e.getName()))},g=function(b,c){b.setAttribute("class","col bundle__file_view__icon");var a=document.createElement("i");
void 0!==c&&a.setAttribute("class",c.isLeafNode()?"fi-page":"fi-folder");b.appendChild(a)},m=function(b,c){if(c.isLeafNode()){b.setAttribute("class","col");var f=document.createElement("a");f.textContent=c.getName();f.setAttribute("href","");f.onclick=function(b){a.loadFileContentAsync(d,c);b.preventDefault()}}else b.setAttribute("class","col bundle-item-type-folder"),f=document.createElement("a"),f.textContent=c.getName(),f.setAttribute("href",""),f.onclick=function(b){a.loadContentAsync(d,c);b.preventDefault()};
b.appendChild(f)},c=function(b,c){var a=document.createElement("img"),f=[c.getUrl().replace("api/bundles/content","api/bundles/filecontent"),c.getFullName()].join("/");a.setAttribute("src",f);a.setAttribute("style","max-width:900px");return[a]},k=function(b,c){var a=document.createElement("iframe"),f=[c.getUrl().replace("api/bundles/content","api/bundles/filecontent"),c.getFullName()].join("/");a.setAttribute("src",f);a.setAttribute("style","width:100%; min-height:"+Math.max(200,Math.min(900,screen.height/
2))+"px;");return[a]},l={txt:function(b,c){var a=document.createElement("pre");a.setAttribute("class","bundle__file_pre");a.textContent=c.getData();return[a]},htm:k,html:k,jpg:c,png:c},n=function(b,c){var a=c.getName(),f="";0<a.indexOf(".")&&(f=a.toLowerCase().split(".").pop());a=l[f];void 0===a&&(a=l.txt);b.setAttribute("class","col");a(b,c).forEach(function(c){b.appendChild(c)})};return{tableDecorations:"bundle__file_view expanded",rowDecorations:"row",numRows:b,numCols:2,render:function(b,c,a){if(!1===
e.isRootNode()&&0>=b)0==c?f(a):h(a);else if(!0===e.isLeafNode())0==c?g(a):n(a,e);else{var d=0;!1===e.isRootNode()&&(d=1);b=e.getChildren()[b-d];0==c?g(a,b):m(a,b)}}}};a.getMetadataTableModel=function(a){var d=[],b;for(b in a.metadata)"name"!==b&&d.push([b,a.metadata[b]]);return{tableDecorations:"bundle__meta_table",rowDecorations:"row",numRows:d.length,numCols:2,render:function(b,a,h){0==a?h.setAttribute("class","col bundle__meta_type"):h.setAttribute("class","col");h.textContent=d[b][a]}}};a.getElementType=
function(a,d){return void 0!==a?a:d};a.renderTable=function(a,d){};a.prototype.render=function(e){var d=$(this.template.cloneNode(!0));d.find(".bundle-name").text(e.metadata.name);d.find(".bundle-icon-sm").removeClass("bundle-icon-sm").addClass("bundle-icon-sm--"+e.bundle_type+"--"+e.state);d.find(".bundle-uuid").text(e.uuid);d.find(".bundle-link").attr("href","/bundles/"+e.uuid);d.find(".bundle-download").on("click",function(b){b.preventDefault();console.log(b);console.log(c.get(0));root=new BundleContentNode("/api/bundles/content",
e.uuid);console.log(root)});var b=d.find(".bundle-meta-view-container").get(0);a.renderTable(b,a.getMetadataTableModel(e));d.find(".bundle__expand_button");var c=d.find(".bundle-file-view-container");return d.get(0)};return a}(),WorkshhetDirectiveRenderer=function(){return function(){var a=this;a.display="inline";a.bundleBlock=null;a.tableDirective=[];a.applyDirective=function(e,d){switch(d[1].directive){case "display":a.display=d[1].display;a.applyPendingDirectives(e);break;case "image":$(e).append($("<img />",
{src:"/api/bundles/filecontent/"+a.bundleBlock.uuid+"/"+encodeURI(d[1].path),"class":"bundleImage",alt:d[1].name}));break;case "metadata":a.tableDirective.push(d[1])}};a.insertRowTable=function(a,d,b){var c=$("<tr></tr>");d.forEach(function(a){c.append($(b).text(a))});a.append(c)};a.getDataFromPath=function(e){return a.bundleBlock.metadata[e]};a.applyPendingDirectives=function(e){if(0<a.tableDirective.length){var d=$("<table></table>");if("table"===a.display){var b=$("<thead></thead>");a.insertRowTable(b,
a.tableDirective.map(function(b){return b.name}),"<th></th>")}var c=$("<tbody></tbody>");"table"===a.display?a.insertRowTable(c,a.tableDirective.map(function(b){return a.getDataFromPath(b.path)}),"<td></td>"):a.tableDirective.forEach(function(b){a.insertRowTable(c,[b.name,a.getDataFromPath(b.path)],"<td></td>")});d.append(b);d.append(c);$(e).append(d);a.tableDirective=[]}}}}(),WorksheetRenderer=function(){return function(a,e,d){this.renderer=e;if(d&&d.items&&Array.isArray(d.items)){var b=this;e=d.name;
var c=d.items.filter(function(b){return"title"===b[2]});0<c.length&&(e=markdown.toHTML("#"+c[0][1]).replace(/^<h1>/,"").replace(/<\/h1>$/,""));$(".worksheet-icon").html(e);$(".worksheet-author").html("by "+d.owner);var f=new WorkshhetDirectiveRenderer,h="";d.items.push([null,"eof",null]);d.items.forEach(function(c,d,e){"directive"!=c[2]&&f.applyPendingDirectives(a);if("markup"!=c[2]&&0<h.length){var l=document.createElement("div");l.innerHTML=markdown.toHTML(h);a.appendChild(l);h=""}switch(c[2]){case "markup":h+=
c[1]+"\n\r";break;case "bundle":a.appendChild(b.renderer.render(c[0]));break;case "directive":e.slice(d+1).forEach(function(b){"bundle"==b[2]&&(f.bundleBlock=b[0])}),f.applyDirective(a,c)}});MathJax.Hub.Queue(["Typeset",MathJax.Hub,a.id]);MathJax.Hub.Queue(function(){for(var b=MathJax.Hub.getAllJax(),c=0;c<b.length;c+=1)$(b[c].SourceElement().parentNode).addClass("coda-jax")})}}}();var Competition;
(function(a){function e(b,c){b.attr("force_submission_to_leaderboard")?c&&b.text("Automatically submitted to leaderboard").attr("disabled","disabled"):c?(b.removeClass("leaderBoardSubmit"),b.addClass("leaderBoardRemove"),b.text("Remove from Leaderboard")):(b.removeClass("leaderBoardRemove"),b.addClass("leaderBoardSubmit"),b.text("Submit to Leaderboard"))}function d(b,c,a,d){b="/api/competition/"+b+"/submission/"+c+"/leaderboard";var g="delete";d.hasClass("leaderBoardSubmit")&&(g="post");request=$.ajax({url:b,
type:g,datatype:"text",data:{csrfmiddlewaretoken:a},success:function(b,a,f){(b="post"==g)?(a=$("#user_results td.status"),a.removeClass("submitted"),a.addClass("not_submitted"),a.html(""),a=$("#"+c+" td.status"),a.addClass("submitted"),a.html("<i class='fi-check'></i>"),$("#user_results button.leaderBoardRemove").each(function(b){e($(this),!1)})):(a=$("#"+c+" td.status"),a.removeClass("submitted"),a.addClass("not_submitted"),a.html(""));e(d,b)},error:function(b,a,c){alert("An error occurred. Please try again or report the issue")},
beforeSend:function(b){b.setRequestHeader("X-CSRFToken",a)}})}a.invokePhaseButtonOnOpen=function(b){var a=$("#"+b+" .button.selected")[0];void 0===a&&(a=$("#"+b+" .button.active")[0],void 0===a&&(a=$("#"+b+" .button")[0]));a.click()};a.getPhaseSubmissions=function(b,c,f){$(".competition_submissions").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+b+"/submissions/"+c,cache:!1,success:function(c){$(".competition_submissions").html("").append(c);
!1===CodaLab.FileUploader.isSupported()?($("#fileUploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new CodaLab.FileUploader({buttonId:"fileUploadButton",sasEndpoint:"/api/competition/"+b+"/submission/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(b,a){$("#fileUploadButton").addClass("disabled")},afterSelection:function(b,a){!1===
a&&(0<b.files.length&&("type-error"===b.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#fileUploadButton").removeClass("disabled"))},uploadProgress:function(b,a,c){a=100*a/c;$("#details").html("Uploading file <em>"+b.name+"</em>: "+a.toFixed(0)+"% complete.")},uploadError:function(b){$("#details").html("There was an error uploading the file. Please try again.");
$("#fileUploadButton").removeClass("disabled")},uploadSuccess:function(c,f){$("#details").html("Creating new submission...");$.ajax({url:"/api/competition/"+b+"/submission",type:"post",cache:!1,data:{id:f,name:c.name,type:c.type,size:c.size}}).done(function(b){$("#details").html("");$("#user_results tr.noData").remove();$("#user_results").append(a.displayNewSubmission(b));$("#user_results #"+b.id+" .fi-plus").on("click",function(){a.showOrHideSubmissionDetails(this)});$("#fileUploadButton").removeClass("disabled");
$("#user_results #"+b.id+" .fi-plus").click()}).fail(function(b){var a="An unexpected error occurred.";403==b.status&&(a=b.responseJSON.detail);$("#details").html(a);$("#fileUploadButton").removeClass("disabled")})}});$("#user_results .fi-plus").on("click",function(){a.showOrHideSubmissionDetails(this)})},error:function(b,a,c){$(".competition_submissions").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};a.getPhaseResults=function(b,a){$(".competition_results").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",
display:"block"});$.ajax({type:"GET",url:"/competitions/"+b+"/results/"+a,cache:!1,success:function(b){$(".competition_results").html("").append(b);$(".column-selectable").click(function(b){b=$(this).closest("table");$(b).find(".column-selected").removeClass();$(this).addClass("column-selected");var a=$(this).attr("name");b=b.find("td").filter(function(){return $(this).attr("name")===a}).addClass("column-selected");if(0<b.length)for(var c=b.slice().sort(function(b,a){var c=parseInt($.text([$(b).find("span")]));
isNaN(c)&&(c=1E5);var f=parseInt($.text([$(a).find("span")]));isNaN(f)&&(f=1E5);return c-f}),f=b[0].parentNode.parentNode,c=c.map(function(){return this.parentNode.cloneNode(!0)}),d=0;d<c.length;d++)$(c[d]).find("td.row-position").text($(c[d]).find("td.column-selected span").text()),f.insertBefore(c[d],b[d].parentNode),f.removeChild(b[d].parentNode)})},error:function(b,a,c){$(".competition_results").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};a.registationCanProceed=
function(){!0===$("#checkbox").is(":checked")?$("#participateButton").removeClass("disabledStatus"):$("#participateButton").addClass("disabledStatus")};a.displayRegistrationStatus=function(b){var a="";$.ajax({type:"GET",url:"/api/competition/"+b+"/mystatus/",cache:!1,success:function(b){console.log(b);"approved"==b.status?location.reload():"pending"==b.status?(a="<div class='participateInfoBlock pendingApproval'>",a+="<div class='infoStatusBar'></div>",a+="<div class='labelArea'>",a+="<label class='regApprovLabel'>Your request to participate in this challenge has been received and a decision is pending.</label>",
a+="<label></label>",a+="</div>",a+="</div>"):"denied"==b.status&&(a="<div class='participateInfoBlock'>",a+="<div class='infoStatusBar'></div>",a+="<div class='labelArea'>",a+="<label class='regDeniedLabel'>Your request to participate in this challenge has been denied. The reason for your denied registrations is: "+b.reason+"</label>",a+="<label></label>",a+="</div>",a+="</div>");location.reload()},error:function(b,a,c){$(".competition_results").html("<div class='alert - error'>An error occurred. Please try refreshing the page.</div>")}});
return a};a.displayNewSubmission=function(b){var c=$("#submission_details_template #submission_row_template tr").clone();$(c).attr("id",b.id.toString());$(c).addClass(a.oddOrEven(b.submission_number));$(c).children().each(function(c){switch(c){case 0:"finished"===b.status&&$(this).val("1");break;case 1:$(this).html(b.submission_number.toString());break;case 2:$(this).html(b.filename);break;case 3:var d=function(b){b=b.toString();1==b.length&&(b="0"+b);return b},e=new Date(b.submitted_at);c=$.datepicker.formatDate("mm/dd/yy",
e).toString();var m=e.getHours().toString(),k=d(e.getMinutes()),d=d(e.getSeconds());$(this).html(c+" "+m+":"+k+":"+d);break;case 4:$(this).html(a.getSubmissionStatus(b.status))}});return c};a.oddOrEven=function(b){return b&1?"odd":"even"};a.getSubmissionStatus=function(b){var a="Unknown";"submitting"===b?a="Submitting":"submitted"===b?a="Submitted":"running"===b?a="Running":"failed"===b?a="Failed":"cancelled"===b?a="Cancelled":"finished"===b&&(a="Finished");return a};a.showOrHideSubmissionDetails=
function(b){var c=$(b).parents("tr")[0];if($(b).hasClass("fi-minus"))$(b).removeClass("fi-minus"),$(b).addClass("fi-plus"),$(c).next("tr.trDetails").remove();else{$(b).removeClass("fi-plus");$(b).addClass("fi-minus");b=$("#submission_details_template .trDetails").clone();b.find(".tdDetails").attr("colspan",c.cells.length);b.find("a").each(function(b){$(this).attr("href",$(this).attr("href").replace("_",c.id))});var f=$("#phasestate").val(),h=$(c).find("input[name='state']").val();if(1==f&&1==h){var g=
b.find("button");g.removeClass("hide");var f=$(c).find(".status").hasClass("submitted"),m=$("#competitionId").val();e(g,f);g.on("click",function(){d(m,c.id,$("#cstoken").val(),g)})}else{f=$.trim($(c).find(".statusName").html());g=b.find("button").addClass("hide");if("Submitting"===f||"Submitted"===f||"Running"===f)g.removeClass("hide"),g.text("Refresh status"),g.on("click",function(){a.updateSubmissionStatus($("#competitionId").val(),c.id,this)});"Failed"!==f&&"Cancelled"!==f||b.find("a").removeClass("hide")}$(c).after(b)}};
a.updateSubmissionStatus=function(b,c,f){$(f).parents(".submission_details").find(".preloader-handler").append("<div class='competitionPreloader'></div>").children().css({top:"25px",display:"block"});$.ajax({type:"GET",url:"/api/competition/"+b+"/submission/"+c,cache:!1,success:function(e){$("#user_results #"+c).find(".statusName").html(a.getSubmissionStatus(e.status));if("finished"===e.status)$("#user_results #"+c+"input:hidden").val("1"),1==$("#phasestate").val()?$(f).attr("force_submission_to_leaderboard")?
$(f).text("Automatically submitted to leaderboard").attr("disabled","disabled"):($(f).addClass("leaderBoardSubmit"),$(f).text("Submit to Leaderboard"),$(f).on("click",function(){d(b,c,$("#cstoken").val(),$(f))})):$(f).addClass("hide");else if("failed"===e.status||"cancelled"===e.status)$(f).addClass("hide"),$(f).parent().parent().find("a").removeClass("hide");$(".competitionPreloader").hide()},error:function(b,a,c){}})};a.initialize=function(){$(document).ready(function(){$("#participate_form").submit(function(b){b.preventDefault();
if($("#participateButton").hasClass("disabledStatus"))return!1;$("#result").html("");b=$(this).serialize();var f=$("#competitionId").val();request=$.ajax({url:"/api/competition/"+f+"/participate/",type:"post",dataType:"text",data:b,success:function(b,c,d){$(".content form").replaceWith(a.displayRegistrationStatus(f))},error:function(b,a,c){alert("There was a problem registering for this competition.")}});return!1});$("#submissions_phase_buttons .button").each(function(b,d){$(this).click(function(){var b=
$.trim($(this).attr("id").replace("submissions_phase_",""));$("#submissions_phase_buttons .button").removeClass("selected");$(this).addClass("selected");var c=$("#competitionId").val(),d=$("#cstoken").val();a.getPhaseSubmissions(c,b,d)})});$("a[href='#participate-submit_results']").click(function(b){a.invokePhaseButtonOnOpen("submissions_phase_buttons")});$("#results_phase_buttons .button").each(function(b,d){$(this).click(function(){var b=$.trim($(this).attr("id").replace("results_phase_",""));$("#results_phase_buttons .button").removeClass("selected");
$(this).addClass("selected");var c=$("#competitionId").val();a.getPhaseResults(c,b)})});$("#Results").click(function(b){a.invokePhaseButtonOnOpen("results_phase_buttons")});$(this).foundation("section","reflow");$(".top-bar-section ul > li").removeClass("active");$("#liCompetitions").addClass("active");$(".my_managing .competition-tile #competition-actions").each(function(b,a){$(this).children("#competition-publish-button").click(function(){var b=$(this).parent()[0];request=$.ajax({url:$(this)[0].value,
success:function(a,c,d){console.log("Published competition.");$(b).children("#competition-publish-button").hide();$(b).children("#competition-delete-button").hide();$(b).children("#competition-unpublish-button").show()},error:function(b,a,c){console.log("Error publishing competition!")}})});$(this).children("#competition-unpublish-button").click(function(){});"True"==$(this)[0].getAttribute("published")?($(this).children("#competition-delete-button").hide(),$(this).children("#competition-publish-button").hide(),
$(this).children("#competition-unpublish-button").show()):($(this).children("#competition-delete-button").show(),$(this).children("#competition-publish-button").show(),$(this).children("#competition-unpublish-button").hide())});var b=window.location.href;void 0!==b&&(null!==b.match(/#participate-submit_results$/i)?a.invokePhaseButtonOnOpen("submissions_phase_buttons"):null!==b.match(/#results$/i)&&a.invokePhaseButtonOnOpen("results_phase_buttons"))})}})(Competition||(Competition={}));var csrftoken;function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}function sameOrigin(a){var e="//"+document.location.host,d=document.location.protocol+e;return a==d||a.slice(0,d.length+1)==d+"/"||a==e||a.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(a)}$(function(){csrftoken=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(a,e){!csrfSafeMethod(e.type)&&sameOrigin(e.url)&&a.setRequestHeader("X-CSRFToken",csrftoken)}})});var CodaLab;
(function(a){var e=function(){function a(b){var c=this;this.defaultOptions={buttonId:"fileUploadButton",disabledClassName:"disabled",beforeSelection:function(){},afterSelection:function(b,a){},uploadProgress:function(b,a,c){},uploadSuccess:function(b){},uploadError:function(b){},allowedFileTypes:void 0,extensionToFileType:{zip:"application/zip"},maxFileSizeInBytes:void 0,maxBlockSizeInBytes:1048576};this.options=$.extend({},this.defaultOptions,b);var f=$("#"+this.options.buttonId);this.setupFileInput();
f.after(this.fileInput);f.on("click",function(b){f.hasClass(c.options.disabledClassName)||c.fileInput.click()})}a.prototype.setupFileInput=function(){var b=this,c=this.fileInput;this.fileInput=$(document.createElement("input"));this.fileInput.attr("type","file");this.fileInput.attr("style","visibility: hidden; width: 1px; height: 1px;");this.fileInput.on("change",function(c){b.options.beforeSelection();c=b.validate();var e=0<c.files.length&&!0===a.selectionIsValid(c);b.options.afterSelection(c,e);
e?b.beginUpload(c,0):b.setupFileInput()});void 0!==c&&c.replaceWith(this.fileInput)};a.prototype.validate=function(){var b=this,a=this.fileInput.get(0).files,d=[];0<a.length&&$.each(a,function(a,c){var e=[];b.options.maxFileSizeInBytes&&c.size>b.options.maxFileSizeInBytes&&e.push({kind:"size-error"});var k=c.type;if(""===k){var l=c.name.split(".");1<l.length&&(k=b.options.extensionToFileType[l.pop().toLowerCase()])}b.options.allowedFileTypes&&-1===$.inArray(k,b.options.allowedFileTypes)&&e.push({kind:"type-error"});
d.push({file:c,errors:e})});return{files:d}};a.selectionIsValid=function(b){return 0===b.files.map(function(b){return b.errors.length}).reduce(function(b,a,d,e){return b+a},0)};a.prototype.getCurrentFile=function(){if(void 0!==this.state)return this.state.selection.files[this.state.fileIndex].file};a.prototype.getFileReader=function(){var b=this,a=new FileReader;a.onload=function(a){var c=b.state.sasUrl+"&comp=block&blockid="+b.state.blockIds[b.state.blockIds.length-1];a=new Uint8Array(a.target.result);
var d=b.state.sasVersion;$.ajax({url:c,type:"PUT",data:a,processData:!1,beforeSend:function(b){b.setRequestHeader("x-ms-version",d);b.setRequestHeader("x-ms-blob-type","BlockBlob")},success:function(a,c){var d=b.getCurrentFile();b.options.uploadProgress(d,b.state.bytesUploaded,d.size);b.state.bytesUploaded<d.size?b.upload():b.endUpload()},error:function(a,c,d){b.options.uploadError({kind:"write-error",jqXHR:a,file:b.getCurrentFile()})}})};a.onerror=function(a){b.options.uploadError({kind:"read-error",
message:a.message,file:b.getCurrentFile()})};return a};a.prototype.beginUpload=function(b,a){this.state={sasUrl:void 0,sasVersion:void 0,trackingId:void 0,reader:void 0,selection:b,fileIndex:a,blockIds:[],bytesUploaded:0};var d=this.getCurrentFile(),e=this;$.ajax({url:e.options.sasEndpoint,type:"POST",data:{name:d.name,type:d.type,size:d.size},success:function(b,a){e.state.sasUrl=b.url;e.state.sasVersion=b.version;e.state.trackingId=b.id;e.state.reader=e.getFileReader();e.options.uploadProgress(d,
e.state.bytesUploaded,d.size);e.upload()},error:function(b,a,c){e.options.uploadError({kind:"sas-error",jqXHR:b,file:e.getCurrentFile()})}})};a.prototype.upload=function(){var b=this.getCurrentFile(),a=this.state.bytesUploaded,d=a+Math.min(b.size-a,this.options.maxBlockSizeInBytes),b=b.slice(a,d),a="000000"+(this.state.blockIds.length+1),a=btoa(a.substring(a.length-6));this.state.blockIds.push(a);this.state.bytesUploaded=d;this.state.reader.readAsArrayBuffer(b)};a.prototype.endUpload=function(){var b=
this.state.sasUrl+"&comp=blocklist",a=this.getCurrentFile(),d=['<?xml version="1.0" encoding="utf-8"?>'];d.push("<BlockList>");for(var e=0;e<this.state.blockIds.length;e++)d.push("  <Latest>"+this.state.blockIds[e]+"</Latest>");d.push("</BlockList>");var g=this;$.ajax({url:b,type:"PUT",contentType:"application/xml",processData:!1,data:d.join("\n"),beforeSend:function(b){b.setRequestHeader("x-ms-version",g.state.sasVersion);b.setRequestHeader("x-ms-blob-content-type",a.type);b.setRequestHeader("x-ms-meta-name",
a.name);b.setRequestHeader("x-ms-meta-size",a.size.toString())},success:function(b,d){g.options.uploadSuccess(a,g.state.trackingId);var e=1+g.state.fileIndex;e<g.state.selection.files.length?g.beginUpload(g.state.selection,e):g.setupFileInput()},error:function(b,a,c){g.options.uploadError({kind:"write-error",jqXHR:b,file:g.getCurrentFile()})}})};a.isSupported=function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1};return a}();a.FileUploader=e;(function(a){a.CreateReady=
function(){!1===e.isSupported()?($("#uploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new e({buttonId:"uploadButton",sasEndpoint:"/api/competition/create/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(b,a){$("#uploadButton").addClass("disabled")},afterSelection:function(b,a){!1===a&&(0<b.files.length&&("type-error"===b.files[0].errors[0].kind?
$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#uploadButton").removeClass("disabled"))},uploadProgress:function(b,a,d){a=100*a/d;$("#details").html("Uploading file <em>"+b.name+"</em>: "+a.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#uploadButton").removeClass("disabled")},uploadSuccess:function(a,
c){$("#details").html("Creating competition... This may take a while. Please be patient.");$.ajax({url:"/api/competition/create",type:"post",cache:!1,data:{id:c,name:a.name,type:a.type,size:a.size}}).done(function(a){var b=function(){$.ajax({url:"/api/competition/create/"+a.token,type:"get",cache:!1,data:{csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val()}}).done(function(a){"finished"==a.status?($("#details").html("Congratulations! Your new competition is ready to <a href='/competitions/"+
a.id+"'>view</a>. You can also manage it from <a href='/my/#manage'>your CodaLab dashboard.</a>"),$("#uploadButton").removeClass("disabled")):"failed"==a.status?($("#details").html("Oops! There was a problem creating the competition."),$("#uploadButton").removeClass("disabled")):setTimeout(b,1E3)}).fail(function(){$("#details").html("An unexpected error occurred.");$("#uploadButton").removeClass("disabled")})};b()}).fail(function(){$("#details").html("An unexpected error occurred.");$("#uploadButton").removeClass("disabled")})}})}})(a.Competitions||
(a.Competitions={}))})(CodaLab||(CodaLab={}));angular.module("codalab.services",[]);angular.module("codalab.controllers",[]);angular.module("codalab.directives",[]);
angular.module("codalab",["ngRoute","ngAnimate","codalab.controllers","codalab.services","codalab.directives"]).factory("$exceptionHandler",function(){return function(a){console.error(a.message);error(a)}}).config(["$routeProvider","$locationProvider","$httpProvider","$interpolateProvider",function(a,e,d,b){a.when("/worksheets/app/:uuid/",{templateUrl:"/static/app/partials/worksheet.html",controller:"worksheet"}).when("/my",{templateUrl:"/static/app/partials/myworksheets.html",controller:"worksheets"}).otherwise({templateUrl:"/static/app/partials/worksheets.html",
controller:"worksheets"});e.html5Mode(!0);b.startSymbol("{[{");b.endSymbol("}]}")}]);angular.module("codalab.services").factory("worksheetsApi",["$http",function(a){var e=function(a,b,d,e){return a.data},d=function(a,b,d,e){throw a;},b=function(b){return function(){return a.get(b+"?preventCache="+Math.floor(1E3*Math.random())).then(e,d)}};return{info:b("/api/worksheets/info/"),worksheets:b("/api/worksheets/"),createWorksheet:function(b){return function(f){var h=$.cookie("csrftoken");!csrfSafeMethod("POST")&&sameOrigin(b)&&(a.defaults.headers.common["X-CSRFToken"]=h);return a.post(b,
f).then(e,d)}}("/api/worksheets/")}}]);angular.module("codalab.controllers").controller("root",["$scope","worksheetsApi",function(a,e){e.info().then(function(d){a.config=d.config;a.user=d.user})}]);angular.module("codalab.controllers").controller("worksheets",["$scope","$location","worksheetsApi",function(a,e,d){a.status="loading";a.selectionIndex=0;a.worksheets=[];a.statusMessage=function(b){var c={"":"",loading:"Loading worksheets...",loaderror:"Couldn't retrieve worksheets - Try refreshing the page",empty:"There are no worksheets.",saving:"Saving",saveerror:"Couldn't save - Try a different name"};switch(b){case "loaded":return 0<a.worksheets.length?"":c.empty}return c[b]};a.hasStatus=function(a){return a&&
0<a.length};d.worksheets().then(function(b){a.status="loaded";0===e.path().indexOf("/my")&&(b=b.filter(function(b){return b.owner===a.user.name}));angular.forEach(b,function(b){b.url="/worksheets/"+b.uuid;b.target="_self";b.editable=!1;var d=b.items.filter(function(a){return"title"==a.type});b.title=0<d.length?d[0].value:b.name;d=b.items.filter(function(a){return"description"==a.type});0<d.length&&d.forEach(function(a){b.description=a.value+"\n"});a.worksheets.push(b)})},function(){a.status="loaderror"});
a.saveWorksheet=function(a){a.status="saving";d.createWorksheet(a).then(function(c){a.name=c.name;a.title=c.name;a.uuid=c.uuid;a.owner=c.owner;a.url="/worksheets/"+a.uuid;a.editable=!1;a.target="_self"},function(){a.status="saveerror"})};a.worksheetEnabled=function(a){return 0<a.name.length};a.addWorksheet=function(b,c){a.selectionIndex=b+(c?1:0);a.worksheets.splice(a.selectionIndex,0,{name:"",editable:!0,url:"#",owner:a.user.name})};a.keyPressed=function(b){if(b.ctrlKey)switch(b.keyCode){case 38:case 40:a.user.authenticated&&
(a.addWorksheet(a.selectionIndex,40===b.keyCode),b.preventDefault())}else switch(b.keyCode){case 38:a.selectionIndex=0<a.selectionIndex?a.selectionIndex-1:0;b.preventDefault();break;case 40:a.selectionIndex=a.selectionIndex<a.worksheets.length-1?a.selectionIndex+1:a.worksheets.length-1,b.preventDefault()}};a.gotFocus=function(b){a.selectionIndex=b};a.lostFocus=function(b){a.selectionIndex===b&&(a.selectionIndex=a.selectionIndex===a.worksheets.length-1?a.selectionIndex=a.worksheets.length:-1)}}]);angular.module("codalab.controllers").controller("worksheet",["$scope","worksheetsApi",function(a,e){a.status="Loading worksheet..."}]);angular.module("codalab.directives").directive("shortcut",function(){return{restrict:"E",replace:!0,scope:!0,link:function(a,e,d){var b=function(b){a.$apply(a.keyPressed(b))};$(document).on("keydown",b);a.$on("$destroy",function(){$(document).off("keydown",b)})}}});angular.module("codalab.directives").directive("setFocus",["$timeout",function(a){return{scope:{trigger:"@setFocus"},restrict:"A",link:function(e,d,b){b.$observe("setFocus",function(b){"true"===b&&document.activeElement!=d&&a(function(){"true"===e.trigger&&(d[0].focus(),e.trigger=!1)})})}}}]);angular.module("codalab.directives").directive("scrollIntoView",["$timeout",function(a){return{scope:{trigger:"@scrollIntoView"},restrict:"A",link:function(e,d,b){b.$observe("scrollIntoView",function(b,f){"true"===b&&b!==f&&a(function(){"true"===e.trigger&&(d[0].scrollIntoView(),e.trigger=!1)})})}}}]);//# sourceMappingURL=/static/codalab.min.map
